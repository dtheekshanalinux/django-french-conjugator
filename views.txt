from django.shortcuts import render
import requests
from requests.compat import quote_plus # this thing add  sign to spaces
from bs4 import BeautifulSoup
from . import models

BASE_CONJUGATOR_URL = 'https://conjugator.reverso.net/conjugation-french-verb-{}.html'

def home(request):
    return render(request, 'base.html')

def new_search(request):
    search = request.POST.get('search')
    models.search.objects.create(search=search)
    print(quote_plus(search))
    Final_url = BASE_CONJUGATOR_URL.format(quote_plus(search))
    print(Final_url)
    response = requests.get(Final_url)
    data = response.text
    soup = BeautifulSoup(data, features='html.parser')

    card_listings = soup.find_all('div', {'class':'result-block-api'})
    #all content we want
    card_postings = []
    
    # body card detail 
    card_detail = soup.find_all('div',{'class':'word-wrap-title'})
    for card in card_detail:
        card_title = card.find('h4').text

        card_postings.append((card_title))
    print(card_postings)

    # post title
     
    # this function is for get that how many cards for specific title 
    def post_title_detail():
        div_list = []
        all_div_datail = soup.find_all('div',{'class':'blue-box-wrap'})
        for div in all_div_datail:
            post_title_i = div.find('p').text
            div_list.append((post_title_i))

        div_second = []
        for index in range(len(div_list)):
            #print(index, my_list[index], end = "\n")
            div_second.append(div_list[index])
            if div_list[index] == 'Pr√©sent' and index != 0:
                continue
        div_second.pop()
        return div_second

    post_title_listings = post_title_detail()
    print(post_title_listings)


    stuff_for_frontend = {
    'search':search,
    'card_postings':card_postings,
    'post_title_listings':post_title_listings,
    }
    return render(request, 'index.html', stuff_for_frontend)
    
# this function is for get that how many cards for specific title 
